asyncapi: 3.0.0
info:
  title: Order Fulfillment Service
  version: 1.0.0
  description: |
    ## Order Fulfillment Service
    
    This service consumes order events from SQS (bridged from Kafka via Redpanda Connect)
    and processes them through the fulfillment pipeline.
    
    ### Events Consumed
    
    - **OrderCreated**: Triggers the fulfillment process
    
    ### Processing Pipeline
    
    ```
    Kafka → Redpanda Connect → SQS → Consumer → Process Order
    ```
    
    ### Architecture
    
    The consumer uses aiobotocore to poll SQS for messages. Each message is 
    validated as an OrderCreated event and processed through the fulfillment 
    workflow (accept → ship → fulfill).

servers:
  localstack:
    host: localstack:4566
    protocol: sqs
    description: LocalStack SQS endpoint for local development

channels:
  order-events:
    address: order-events
    messages:
      OrderCreated:
        $ref: '#/components/messages/OrderCreated'
    description: SQS queue receiving order events bridged from Kafka

operations:
  receiveOrderCreated:
    action: receive
    channel:
      $ref: '#/channels/order-events'
    summary: Receive order created events
    description: |
      Consumes OrderCreated events from the order-events SQS queue.
      Messages are bridged from Kafka via Redpanda Connect.
      
      Processing steps:
      1. Validate message as OrderCreated
      2. Accept order and assign warehouse
      3. Generate shipping label and tracking number
      4. Mark order as fulfilled
    messages:
      - $ref: '#/channels/order-events/messages/OrderCreated'

components:
  messages:
    OrderCreated:
      name: OrderCreated
      title: Order Created Event
      summary: Event emitted when a new order is placed
      contentType: application/json
      payload:
        $ref: '#/components/schemas/OrderCreated'

  schemas:
    OrderCreated:
      type: object
      required:
        - order_id
        - customer_id
        - customer_email
        - items
        - total_amount
        - shipping_address
        - created_at
      properties:
        order_id:
          type: string
          description: Unique order identifier
          example: ord_abc123
        customer_id:
          type: string
          description: Customer identifier
          example: cust_xyz789
        customer_email:
          type: string
          format: email
          description: Customer email address
          example: customer@example.com
        items:
          type: array
          items:
            $ref: '#/components/schemas/OrderItem'
          description: List of items in the order
        total_amount:
          type: string
          description: Total order amount (decimal as string)
          example: "99.99"
        shipping_address:
          $ref: '#/components/schemas/Address'
        created_at:
          type: string
          format: date-time
          description: When the order was created
        metadata:
          type: object
          additionalProperties:
            type: string
          description: Optional metadata

    OrderItem:
      type: object
      required:
        - product_id
        - product_name
        - quantity
        - unit_price
      properties:
        product_id:
          type: string
          example: prod_001
        product_name:
          type: string
          example: Widget Pro
        quantity:
          type: integer
          minimum: 1
          example: 2
        unit_price:
          type: string
          example: "49.99"

    Address:
      type: object
      required:
        - street
        - city
        - state
        - zip_code
      properties:
        street:
          type: string
          example: 123 Main St
        city:
          type: string
          example: Springfield
        state:
          type: string
          example: IL
        zip_code:
          type: string
          example: "62701"
        country:
          type: string
          default: USA
          example: USA

